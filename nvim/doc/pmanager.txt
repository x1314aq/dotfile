*pmanager.txt*  Package Manager for Neovim v0.5.0      Last change: 2021-04-19
*pmanager*
*pmanager*

License: MIT

==============================================================================
CONTENTS                                                        *pmanager-contents*

  Introduction                                            |pmanager-introduction|
    Features
  Usage                                                   |pmanager-usage|
  Functions and Commands                                  |pmanager-commands|
  Package options                                         |pmanager-options|
  Commands                                                |pmanager-commands|
  pmanager directory                                      |pmanager-dir|
  pmanager log                                            |pmanager-log|
  Miscellaneous                                           |pmanager-misc|
    Using local packages
    Lazy loading


==============================================================================
INTRODUCTION                                                *pmanager-introduction*

pmanager is a Neovim package manager. It can install, update and remove packages
from any valid git repository, and it includes a familiar shorthand for
GitHub repositories.

pmanager is written in Lua. It uses the |loop| API to install and update packages
asynchronously, and it stores packages in |packpath| directories.

pmanager is for Neovim users who use Lua as their configuration language. It was
written to be a wrapper around existing Neovim features, and to have a simple
and familiar interface for declaring packages.

pmanager doesn't modify the |runtimepath|. Nowadays Neovim provides more structured
ways to handle package loading, that can be used without any other special scripts.

NOTE: Requirements and installation instructions can be found in the README.


------------------------------------------------------------------------------
FEATURES~

- Easy to use and configure

- Fast installation and updating using Neovim's |loop|

- Small implementation


==============================================================================
USAGE                                                              *pmanager-usage*

To get started with pmanager:

 1. Import the `pmanager` module, and bind the `pmanager` function:
 >
    vim.cmd('packadd pmanager')
    local pm = require'pmanager'    -- Module
    local plug = pm.plug            -- Function
<

 2. List the packages you want to install using the `plug` function with the
    name of a package repository, for example:
>
    plug 'lervag/vimtex'
<

 3. Run the `:PMInstall` command.

That's it!


==============================================================================
FUNCTIONS AND COMMANDS                                          *pmanager-commands*
                                                               *pmanager-functions*

The pmanager module exports multiple functions. Most of these functions have a
command alias to make them easier to call on demand. Assuming the module is
imported as `pmanager`, the functions are:

|pmanager.plug|                                                       *pmanager.plug*

  Add a package to pmanager's (internal) list. It can take a table or a string.
  When a table is passed, the first value has to be a string with the name of
  the repository, like: `'<GitHub-username>/<repository-name>'`.
  The other key-value pairs in the table have to be named explicitly, see
  |pmanager-options|. If only a string is passed, it works as if it was the first
  value of the table, and all other options will be set to their default
  values.

  Note: Lua can elide parentheses when passing a table or a string to a
  function, so you can always call `plug` without parentheses.


|pmanager.install|                                                    *pmanager.install*
                                                               *:PMInstall*
  Installs all packages listed on your configuration, if a package is already
  installed, the function ignores it.


|pmanager.update|                                                      *pmanager.update*
                                                                *:PMUpdate*
  Updates the installed packages listed on your configuration. If a package
  hasn't been installed with |pmanagerInstall|, the function ignores it.


|pmanager.clean|                                                        *pmanager.clean*
                                                                 *:PMClean*
  Removes packages found on |pmanager-dir| that aren't listed in your
  configuration.


|pmanager.list|                                                          *pmanager.list*
                                                                  *:PMList*
  Lists installed packages as well as packages that were recently removed.
  Recently installed or updated packages are marked with a `+` and `*`,
  respectively.


|pmanager.log|                                                  *pmanager.log*
                                                               *:PMLog*
  Opens the |pmanager-log| file in a split window.


|pmanager.setup|                                                        *pmanager.setup*

  Configures specific global behavior. It takes as single input a table,
  which can have a key `path` to overwrite the default value for |pmanager-dir|.
  This functionality exists mainly to allow testing without altering a
  user's configuration.


==============================================================================
PACKAGE OPTIONS                                                  *pmanager-options*

You can pass a table with named options to the |pmanager.pmanager| function.
These options don't need to be in any particular order, as long as the
name of the repository is the first element on the table.

The options are the following:

`as`
  String indicating the alias or name of the plugin, which determines the name
  of the directory where pmanager will download the plugin.

  If left unspecified, pmanager will infer it from the plugin string.
  For `'<GitHub-username>/<repo-name>'` that is `<repo-name>`.

  Default value: `nil`


`branch`
  String with the name of a branch of the git repository. pmanager will fetch
  and pull changes from this branch.

  Default value: `nil`


`run`
  Either a string or a function to be executed after installing or updating
  a package. Useful for packages that require extra configuration or
  building binaries.

  If a string, pmanager will execute the string as a shell command in the
  directory of the package.

  If a function, pmanager will execute the function right after installing
  the package. The function cannot take any arguments.

  Note that in nvim 0.5, you can wrap a VimL function like so:
>
    pmanager{ '<name-of-package>', run=vim.fn['<name-of-viml-function>'] }
<

  Default value: `nil`


`hook`
  Deprecated. Use the `run` option instead.


`opt`
  Boolean indicating whether the package is optional or not. If set,
  the package will be in the optional packages directory. See |packages|
  and |packadd|.

  Default value: `false`


`url`
  String indicating the URL of the git repository. This allows pmanager to
  download packages from any website. For convenience, if `url` is unset,
  pmanager will try to find the repository on GitHub.com.

  Default value: `'https://github.com/' .. '<GitHub-username>/<repo-name>'`


Example~

The language client `coc.nvim` recommends installing the release branch of
their repository. If we also wanted to install it as an optional package,
we could call `pmanager` like:
>
    pmanager {'neoclide/coc.nvim', opt=true, branch='release'}
<

==============================================================================
pmanager DIRECTORY                                                        *pmanager-dir*

pmanager installs packages using Neovim's |packages| convention, which itself
follows the XDG Base Directory specification. You can find the directory
where pmanager installs packages by running the command:
>
    :echo stdpath('data') .. '/site/pack/managed/opt'
<
If you have packages that aren't managed by pmanager, you shouldn't put them on
pmanager's directory, since |pmanager.clean| could delete them.


==============================================================================
pmanager LOG                                                              *pmanager-log*

pmanager writes the `stderr` output of external processes to a log file.
The log file can be found at:
>
    :echo stdpath('cache') .. '/pmanager.log'
<

==============================================================================
pmanager MISCELLANEOUS                                                   *pmanager-misc*

These are some features related to using packages, which probably don't
require pmanager. Either because there's already a way to do it in Neovim, or
because they're out of scope for the project.


------------------------------------------------------------------------------
Using local packages~

You don't need pmanager to use local packages. Neovim already provides ways to
load a local plugin, namely:

- Add it to a directory in |packpath| (different from |pmanager-dir|)
- Modify the |runtimepath| directly

The second option just requires you to concatenate the path to the plugin to
your `runtimepath`. In lua, this looks like:
>
    vim.o.runtimepath = vim.o.runtimepath .. ",~/path/to/your/plugin"
<
Use an absolute path, and don't forget the comma!


------------------------------------------------------------------------------
Lazy loading~

pmanager doesn't provide a mechanism to lazy load packages. Before considering
if a package needs to be lazy loaded:

1. Be sure to profile your startup time with the |--startuptime| flag.
2. For VimL plugins, check if the package uses the |autoload| feature.
3. For Lua plugins, check if the package is properly modularized in the `lua/`
   directory.

If the package doesn't do 2. or 3. consider opening an issue in that package's
issue tracker rather than pmanager's. It'll help users of other package managers
too.

If you've checked all that and still think that the package _has_ to be lazy
loaded, you can declare the package as optional, and call |packadd| when
needed.

You can use an |autocommand| to do the lazy loading, but at the time of
writing there isn't a way to declare an autocommand using only Lua.

Example:
>
    pmanager {'author/heavy-plugin', opt=true}
    vim.cmd [[autocmd Filetype ruby packadd! heavy-plugin]]
<

==============================================================================
 vim:tw=78:ts=8:noet:ft=help:norl: